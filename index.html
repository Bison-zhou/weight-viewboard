<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF--8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ΩìÈáçËøΩË∏™ÁúãÊùø</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
    <style>
        /* CSS Ê†∑ÂºèËøõË°å‰∫ÜÂÖ®Èù¢‰ºòÂåñÂíåÁæéÂåñ */
        :root {
            --primary-color: #3498db;
            --primary-color-dark: #2980b9;
            --text-color: #2c3e50;
            --background-color: #f4f7f9;
            --panel-background: #ffffff;
            --border-color: #e2e8f0;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --font-family: 'Segoe UI', 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--panel-background);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .header h1 {
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }

        .panel {
            background: var(--panel-background);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .panel-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .user-filter {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #edf2f7;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-filter:hover {
            background: #e2e8f0;
        }

        .user-filter input {
            margin: 0;
            cursor: pointer;
        }

        .user-filter span {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: var(--primary-color-dark);
        }

        button:active {
            transform: scale(0.98);
        }

        #chartContainer {
            position: relative;
            min-height: 400px;
        }

        canvas {
            width: 100% !important;
            height: 400px !important;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95rem;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        th {
            background-color: #f1f5f9;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .date-cell {
            font-weight: 600;
            background: #f0f7ff;
        }

        .weekend-highlight {
            background-color: #fff9db !important;
        }

        .weight-cell {
            font-weight: 600;
            position: relative;
        }

        .delta {
            font-size: 0.75em;
            padding: 2px 5px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .positive {
            color: var(--success-color);
            background: rgba(39, 174, 96, 0.1);
        }

        .negative {
            color: var(--danger-color);
            background: rgba(231, 76, 60, 0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: var(--panel-background);
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .stat-detail {
            margin-top: 8px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .status-message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .status-info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -25px;
            margin-left: -25px;
            z-index: 10;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .panel {
                padding: 20px 15px;
            }

            th,
            td {
                padding: 8px 10px;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üìâ Body Weight</h1>
        <p>Êï∞ÊçÆÊõ¥Êñ∞Êó∂Èó¥: <span id="updateTime">--</span></p>
        <div id="statusMessage" class="status-message" style="display:none;"></div>
    </div>

    <div class="dashboard">
        <div class="panel">
            <div class="panel-title">
                <span>‰ΩìÈáçÂèòÂåñË∂ãÂäøÂõæ</span>
            </div>
            <div class="controls">
                <div class="filter-group">
                    <strong>Á≠õÈÄâÊàêÂëòÔºö</strong>
                    <div id="filterContainer"></div>
                </div>
                <button onclick="refreshData()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                        <path
                            d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                    </svg>
                    Âà∑Êñ∞Êï∞ÊçÆ
                </button>
            </div>
            <div id="chartContainer">
                <canvas id="weightChart"></canvas>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card" style="border-color: var(--success-color);">
                <h3>ÊúÄ‰Ωé‰ΩìÈáç</h3>
                <div class="stat-value" id="minWeight">--</div>
                <div class="stat-detail" id="minWeightDetail">--</div>
            </div>
            <div class="stat-card" style="border-color: var(--danger-color);">
                <h3>ÊúÄÈ´ò‰ΩìÈáç</h3>
                <div class="stat-value" id="maxWeight">--</div>
                <div class="stat-detail" id="maxWeightDetail">--</div>
            </div>
            <div class="stat-card" style="border-color: var(--primary-color);">
                <h3>Âπ≥Âùá‰ΩìÈáç</h3>
                <div class="stat-value" id="avgWeight">--</div>
                <div class="stat-detail" id="avgTrend">--</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">
                <span>ËØ¶ÁªÜÊï∞ÊçÆË°®</span>
                <div>
                    <label style="cursor:pointer; font-size: 0.9em;"><input type="checkbox" id="showDelta"
                            onchange="renderTable()"> ÊòæÁ§∫‰∏é‰∏äÊ¨°Êï∞ÊçÆÁöÑÂèòÂåñÈáè</label>
                </div>
            </div>
            <div style="max-height: 500px; overflow-y: auto;">
                <table id="weightTable">
                    <thead id="tableHeader"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ===== ÈÖçÁΩÆÂå∫Âüü =====
        const CONFIG = {
            SHEET_ID: "1MOELPmNQ0M9cFupYic6MTSKrBq8aehRdJ-sILfPoTOw", // ËøôÊòØ‰Ω†ÁöÑË°®Ê†ºID
            MEMBER_COLORS: {
                'PD': '#23238E', 'AX': '#BC1717', 'YC': '#000000', 'GL': '#FFCE56',
            },
            REFRESH_INTERVAL: 300000, // 5ÂàÜÈíüËá™Âä®Âà∑Êñ∞ÔºàÊØ´ÁßíÔºâ
            DEBUG_MODE: true
        };
        // ===================

        // ÂÖ®Â±ÄÂèòÈáè
        // let chart = null; // „Äê‰øÆÊ≠£„Äë‰∏çÂÜçÈúÄË¶ÅÂÖ®Â±ÄÂèòÈáèÊù•Ë∑üË∏™ÂõæË°®ÂÆû‰æã
        let rawData = {};

        // Â∑•ÂÖ∑ÂáΩÊï∞ÔºöËé∑ÂèñÊ†ºÂºèÂåñÊó∂Èó¥
        const getFormattedTime = () => new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });

        // Â∑•ÂÖ∑ÂáΩÊï∞ÔºöÁîüÊàêÈöèÊú∫È¢úËâ≤
        const getRandomColor = () => `#${Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0')}`;

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        function toggleLoader(show) {
            let loader = document.getElementById('loader');
            if (show) {
                if (!loader) {
                    loader = document.createElement('div');
                    loader.id = 'loader';
                    loader.className = 'loader';
                    document.getElementById('chartContainer').appendChild(loader);
                }
            } else {
                if (loader) {
                    loader.remove();
                }
            }
        }

        // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
        function showStatus(message, isError = false) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.style.display = 'block';
            statusEl.className = `status-message ${isError ? 'status-error' : 'status-info'}`;
            if (!isError) {
                setTimeout(() => { statusEl.style.display = 'none'; }, 5000);
            }
        }

        // ‰ªéGoogleË°®Ê†ºËé∑ÂèñÊï∞ÊçÆ
        async function fetchData() {
            const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?tqx=out:json&t=${Date.now()}`;
            if (CONFIG.DEBUG_MODE) console.log(`[INFO] ËØ∑Ê±ÇÊï∞ÊçÆ: ${url}`);

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTPÈîôËØØ! Áä∂ÊÄÅÁ†Å: ${response.status}`);

                const text = await response.text();
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);/);

                if (!jsonMatch || !jsonMatch[1]) {
                    throw new Error('Êó†Ê≥ï‰ªéÂìçÂ∫î‰∏≠Ëß£ÊûêJSONPÊï∞ÊçÆ„ÄÇ');
                }

                const jsonData = JSON.parse(jsonMatch[1]);
                if (jsonData.status === 'error') {
                    const errorDetails = jsonData.errors.map(e => e.detailed_message).join('\n');
                    throw new Error(`Google Sheet API ÈîôËØØ: ${errorDetails}`);
                }

                return jsonData;
            } catch (error) {
                console.error('[ERROR] Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:', error);
                showStatus(`Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•: ${error.message}`, true);
                return null;
            }
        }

        // Â§ÑÁêÜÂéüÂßãJSONÊï∞ÊçÆ
        function processData(jsonData) {
            if (!jsonData || !jsonData.table || !jsonData.table.rows || jsonData.table.rows.length === 0) {
                throw new Error('Ë°®Ê†ºÊï∞ÊçÆ‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ„ÄÇ');
            }

            const { cols, rows } = jsonData.table;
            const members = cols.slice(1).map(col => col.label).filter(Boolean);
            if (members.length === 0) throw new Error('Êú™ÊâæÂà∞ÊàêÂëòÂêçÁß∞ÔºåËØ∑Ê£ÄÊü•Ë°®Ê†ºÊ†áÈ¢òË°å„ÄÇ');

            const dataByDate = {};
            const allWeights = [];

            rows.forEach((row, rowIndex) => {
                const dateCell = row.c[0];
                if (!dateCell || !dateCell.v) return;

                const dateStr = dateCell.f || new Date(dateCell.v).toISOString().split('T')[0];
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) {
                    console.warn(`[WARN] Êó†ÊïàÊó•Êúü "${dateCell.v}" Âú®Ë°å ${rowIndex + 1}, Â∑≤Ë∑≥Ëøá„ÄÇ`);
                    return;
                }
                const isoDate = date.toISOString().split('T')[0];

                const dateData = { date: isoDate, rawDate: date };
                members.forEach((member, memberIndex) => {
                    const weightCell = row.c[memberIndex + 1];
                    if (weightCell && weightCell.v !== null) {
                        const weight = parseFloat(weightCell.v);
                        if (!isNaN(weight)) {
                            dateData[member] = weight;
                            allWeights.push({ member, date: isoDate, weight });
                        }
                    }
                });
                dataByDate[isoDate] = dateData;
            });

            const sortedDates = Object.keys(dataByDate).sort((a, b) => new Date(a) - new Date(b));
            return { members, dates: sortedDates, dataByDate, allWeights };
        }

        // ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØ
        function calculateStats() {
            if (!rawData.allWeights || rawData.allWeights.length === 0) return;

            const minEntry = rawData.allWeights.reduce((min, curr) => curr.weight < min.weight ? curr : min);
            document.getElementById('minWeight').textContent = `${minEntry.weight.toFixed(1)} kg`;
            document.getElementById('minWeightDetail').textContent = `${minEntry.member} ¬∑ ${minEntry.date}`;

            const maxEntry = rawData.allWeights.reduce((max, curr) => curr.weight > max.weight ? curr : max);
            document.getElementById('maxWeight').textContent = `${maxEntry.weight.toFixed(1)} kg`;
            document.getElementById('maxWeightDetail').textContent = `${maxEntry.member} ¬∑ ${maxEntry.date}`;

            const avgWeight = rawData.allWeights.reduce((sum, w) => sum + w, 0) / rawData.allWeights.length;
            document.getElementById('avgWeight').textContent = `${avgWeight.toFixed(1)} kg`;
            document.getElementById('avgTrend').textContent = 'Á≠âÂæÖ‰∏ãÊ¨°Âà∑Êñ∞‰ª•ËÆ°ÁÆóË∂ãÂäø';
        }

        // Ê∏≤ÊüìÊàêÂëòÁ≠õÈÄâÂô®
        function renderFilters() {
            const container = document.getElementById('filterContainer');
            container.innerHTML = '';
            rawData.members.forEach(member => {
                const color = CONFIG.MEMBER_COLORS[member] || getRandomColor();
                const filter = document.createElement('label');
                filter.className = 'user-filter';
                filter.innerHTML = `
                    <input type="checkbox" name="user" value="${member}" checked onchange="renderChart()">
                    <span style="background:${color}"></span>
                    ${member}
                `;
                container.appendChild(filter);
            });
        }

        // ÁªòÂà∂ÂõæË°®
        function renderChart() {
            // „Äê‰øÆÊ≠£„Äë‰ΩøÁî® Chart.js ÁöÑÂÆòÊñπAPIÊù•Ëé∑ÂèñÂπ∂ÈîÄÊØÅÂ∑≤Â≠òÂú®ÁöÑÂõæË°®ÂÆû‰æãÔºåËøôÊòØÊúÄÁ®≥Â¶•ÁöÑÊñπÊ≥ï
            const canvasId = 'weightChart';
            const existingChart = Chart.getChart(canvasId);
            if (existingChart) {
                existingChart.destroy();
            }

            const ctx = document.getElementById(canvasId);
            if (!ctx || !rawData.dates) return;

            const selectedMembers = Array.from(document.querySelectorAll('input[name="user"]:checked')).map(el => el.value);
            if (selectedMembers.length === 0) {
                showStatus("ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÊàêÂëòÊù•ÊòæÁ§∫ÂõæË°®", true);
                // Ê∏ÖÁ©∫ÁîªÂ∏É
                const context = ctx.getContext('2d');
                context.clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const datasets = selectedMembers.map(member => ({
                label: member,
                data: rawData.dates.map(date => ({
                    x: rawData.dataByDate[date].rawDate,
                    y: rawData.dataByDate[date][member]
                })).filter(p => p.y !== undefined),
                borderColor: CONFIG.MEMBER_COLORS[member] || getRandomColor(),
                backgroundColor: (CONFIG.MEMBER_COLORS[member] || getRandomColor()) + '30',
                borderWidth: 2.5,
                pointRadius: 1.5,
                pointHoverRadius: 2.5,
                pointBackgroundColor: CONFIG.MEMBER_COLORS[member] || getRandomColor(),
                tension: 0.3,
                fill: false
            }));

            // „Äê‰øÆÊ≠£„ÄëÁõ¥Êé•ÂàõÂª∫Êñ∞ÂõæË°®Ôºå‰∏çÂÜçÂ∞ÜÂÖ∂ËµãÂÄºÁªôÂÖ®Â±ÄÂèòÈáè
            new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { title: { display: true, text: '‰ΩìÈáç (kg)', font: { size: 14, weight: 'bold' } }, grid: { color: 'rgba(0,0,0,0.05)' } },
                        x: { type: 'time', time: { unit: 'day', tooltipFormat: 'yyyy-MM-dd', displayFormats: { day: 'MMM d' } }, title: { display: true, text: 'Êó•Êúü', font: { size: 14, weight: 'bold' } }, grid: { display: false } }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 6, padding: 20, font: { size: 15, weight: 'bold' } } },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)', titleColor: '#333', bodyColor: '#555',
                            borderColor: '#ddd', borderWidth: 1, padding: 12, usePointStyle: true,
                            callbacks: { label: ctx => ` ${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)} kg` }
                        }
                    }
                }
            });
        }

        // Ê∏≤ÊüìÊï∞ÊçÆË°®Ê†º
        function renderTable() {
            const showDelta = document.getElementById('showDelta').checked;
            const headerRow = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            headerRow.innerHTML = ''; tableBody.innerHTML = '';

            const dateHeader = document.createElement('th');
            dateHeader.textContent = 'Êó•Êúü';
            headerRow.appendChild(dateHeader);
            rawData.members.forEach(member => {
                const memberHeader = document.createElement('th');
                memberHeader.textContent = member;
                memberHeader.style.color = CONFIG.MEMBER_COLORS[member] || '#333';
                headerRow.appendChild(memberHeader);
            });

            [...rawData.dates].reverse().forEach(date => {
                const row = document.createElement('tr');
                const dateData = rawData.dataByDate[date];
                const dayOfWeek = dateData.rawDate.getDay();

                const dateCell = document.createElement('td');
                dateCell.textContent = date;
                dateCell.className = 'date-cell';
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    row.classList.add('weekend-highlight');
                }
                row.appendChild(dateCell);

                rawData.members.forEach(member => {
                    const weightCell = document.createElement('td');
                    weightCell.className = 'weight-cell';
                    if (dateData[member] !== undefined) {
                        weightCell.innerHTML = `<span>${dateData[member].toFixed(1)}</span>`;
                        if (showDelta) {
                            let prevWeight = null;
                            for (let i = rawData.dates.indexOf(date) - 1; i >= 0; i--) {
                                const prevDate = rawData.dates[i];
                                if (rawData.dataByDate[prevDate][member] !== undefined) {
                                    prevWeight = rawData.dataByDate[prevDate][member];
                                    break;
                                }
                            }
                            if (prevWeight !== null) {
                                const delta = dateData[member] - prevWeight;
                                if (Math.abs(delta) > 0.01) {
                                    const deltaSpan = document.createElement('span');
                                    deltaSpan.className = `delta ${delta > 0 ? 'negative' : 'positive'}`;
                                    deltaSpan.textContent = delta > 0 ? `+${delta.toFixed(1)}` : delta.toFixed(1);
                                    weightCell.appendChild(deltaSpan);
                                }
                            }
                        }
                    } else {
                        weightCell.textContent = '-';
                    }
                    row.appendChild(weightCell);
                });
                tableBody.appendChild(row);
            });
        }

        // ‰∏ªÂà∑Êñ∞ÂáΩÊï∞
        async function refreshData() {
            toggleLoader(true);
            document.getElementById('chartContainer').style.opacity = '0.5';
            showStatus("Ê≠£Âú®Âä†ËΩΩÊúÄÊñ∞Êï∞ÊçÆ...", false);

            try {
                const jsonData = await fetchData();
                if (!jsonData) {
                    toggleLoader(false);
                    document.getElementById('chartContainer').style.opacity = '1';
                    return;
                }

                const isFirstLoad = !rawData.members;
                rawData = processData(jsonData);

                if (isFirstLoad) {
                    renderFilters();
                }

                renderChart();
                renderTable();
                calculateStats();

                document.getElementById('updateTime').textContent = getFormattedTime();
                showStatus("Êï∞ÊçÆÂä†ËΩΩÊàêÂäü!", false);

            } catch (error) {
                console.error('[ERROR] Â§ÑÁêÜÊï∞ÊçÆÊó∂Âá∫Èîô:', error);
                showStatus(`Â§ÑÁêÜÊï∞ÊçÆÂá∫Èîô: ${error.message}`, true);
                // Âç≥‰ΩøÂá∫ÈîôÔºå‰πüË¶ÅÁ°Æ‰øùÂõæË°®Ë¢´Ê≠£Á°ÆÈîÄÊØÅÔºå‰ª•Èò≤‰∏ãÊ¨°Âà∑Êñ∞Â§±Ë¥•
                renderChart();
            } finally {
                toggleLoader(false);
                document.getElementById('chartContainer').style.opacity = '1';
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ËøêË°å
        window.onload = () => {
            refreshData();
            if (CONFIG.REFRESH_INTERVAL > 0) {
                setInterval(refreshData, CONFIG.REFRESH_INTERVAL);
            }
        };
    </script>
</body>

</html>